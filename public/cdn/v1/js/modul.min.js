var doubleform=0;

(function (url, f, h) {


        f = document.getElementsByTagName('form');
        if ('sbjs' in window) h = sbjs && sbjs.get.current_add && sbjs.get.current_add.hash;
     console.log(h );
        Array.prototype.forEach.call(f, function (a) {
            a.addEventListener('submit', function (e, d, xhr) {

                d = Array.prototype.reduce.call(this.elements, function (p, el, i) {
                    if ((el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') && el.name && el.value) {
                        return p + (p ? '&': '') + el.name + '=' + el.value;
                    } else {
                        return p;
                    }
                }, h ? 'neiros_hash=' + h+'&neiros_visit='+neiros_visit+'&neiros_key='+CBU_GLOBAL.config.widget.key+'&neiros_url='+encodeURIComponent(JSON.stringify(window.location.href)) : '');

                if(doubleform==0){

                    xhr = new XMLHttpRequest();
                    xhr.open('GET', url + '?' + d, true);
                    xhr.send();

                    doubleform=1;

                }
               ;console.log(doubleform);


            })
        })
})('https://cloud.neiros.ru/api/ajax_form');


/*
!function () {

    sbjs.get.session.pgs;
    sbjs.get.udata.vst;
    var e = document.createElement("div");


    e.className = "wrp_cbu", e.innerHTML = ' <div id=cbu_btn class="cbu-phone cbu-blue cbu-show"><div class=cbu-ph-circle></div><div class=cbu-ph-circle-fill></div><div class=cbu-ph-img-circle></div></div><div id=cbu_menu class="box_transition cbu-grey"><div class=cbu_container_top><div class=cbu_buttons><a id=cbu_menu__btn-call class="cbu_buttons__item cbu-blue cbu-icon-call active"></a> <a id=cbu_menu__btn-mail class="cbu_buttons__item cbu-blue cbu-icon-mail"></a></div></div><div class=cbu_container_center><div class=cbu_window_item id=cbu_window_success><div class=cbu_container_center__text><p class=cbu_container_center__text__p>Поздравляем! Ваша заявка успешно отправлена!</p></div></div><div class=cbu_window_item id=cbu_window_error><div class=cbu_container_center__text><p class=cbu_container_center__text__p>Упс, произошла ошибка при передаче данных. Обновите страницу и повторите попытку!</p></div></div><div class=cbu_window_item id=cbu_window_call><div class=cbu_container_center__text><p class=cbu_container_center__text__p>Здравствуйте! Чтобы наш менеджер с вами связался напишите номер и нажмите на кнопку!</p></div><div class=cbu_container_center__actions><div class="ui input custom-wrapper-input"><input name=phone type=text class=custom-wrapper-input__item id=cbu_menu__input-phone max-length=30 placeholder="Введите номер" autocomplete=on></div><div class="ui button basic custom-btn-send" id=cbu_menu__btn-send-phone>Отправить заявку</div></div></div><div class=cbu_window_item id=cbu_window_mail><div class=cbu_container_center__text><p class=cbu_container_center__text__p>Здравствуйте! Здесь вы можете оставить текстовое сообщение!</p></div><div class=cbu_container_center__actions><div class="ui input custom-wrapper-input"><input name=name type=text class=custom-wrapper-input__item id=cbu_menu__input-mail-name max-length=30 placeholder="Введите Имя" autocomplete=on required=""></div><div class="ui input custom-wrapper-input"><input name=email type=text class=custom-wrapper-input__item id=cbu_menu__input-mail-email placeholder="Введите E-mail" autocomplete=on required=""></div><div class="ui input custom-wrapper-input"><textarea name=text rows=3 class="custom-textarea no-resize" maxlength=1000 id=cbu_menu__input-mail-message placeholder="Введите сообщение"></textarea></div><div class="ui button basic custom-btn-send" id=cbu_menu__btn-send-mail>Отправить заявку</div></div></div></div><div class=cbu_container_bottom><div class=cbu_buttons><a id=cbu_menu__btn-close class="cbu_buttons__item cbu-blue cbu-icon-arrow_right"></a></div><div class=cbu_container_bottom__link><a class=cbu_container_bottom__link__item id=widget_link_ads target=_blank></a></div></div></div>', document.body.appendChild(e), CBU_GLOBAL.arrElements = {
        mp3_open: "mp3_open",
        mp3_click_btn: "mp3_click-btn",
        btn_id: "cbu_btn",
        menu_id: "cbu_menu",
        menu__btn_close: "cbu_menu__btn-close",
        menu__btn_call: "cbu_menu__btn-call",
        menu__btn_mail: "cbu_menu__btn-mail",
        menu__btn_input_phone: "cbu_menu__input-phone",
        menu__btn_send_phone: "cbu_menu__btn-send-phone",
        cbu_window_call: "cbu_window_call",
        cbu_window_mail: "cbu_window_mail",
        cbu_menu__btn_send_mail: "cbu_menu__btn-send-mail",
        cbu_menu__input_mail_name: "cbu_menu__input-mail-name",
        cbu_menu__input_mail_email: "cbu_menu__input-mail-email",
        cbu_menu__input_mail_message: "cbu_menu__input-mail-message",
        widget_link_ads: "widget_link_ads",
        cbu_window_success: "cbu_window_success",
        cbu_window_error: "cbu_window_error"
    }, CBU_GLOBAL.vanilaJs = {
        getElementById: function (e) {
            return document.getElementById(e)
        }, addClass: function (e, n) {
            e.classList.add(n)
        }, removeClass: function (e, n) {
            e.classList.remove(n)
        }, getUtm: function () {
        }, getGenStaticData: function () {
            return "url=" + encodeURIComponent(window.location.href) + "&widget_key=" + CBU_GLOBAL.config.widget.key
        }
    }, CBU_GLOBAL.vanilaJs.getDataFormCall = function () {
        var e = CBU_GLOBAL.config.path.formCall + "?format=json&jsoncallback=?&hash="+sbjs.get.first_add.hash+"&visit="+sbjs.get.udata.vst+"&pgs="+sbjs.get.session.pgs+"&phone=" + CBU_GLOBAL.elements.menu__btn_input_phone.value + "&" + CBU_GLOBAL.vanilaJs.getGenStaticData();
        return console.log(e), e
    }, CBU_GLOBAL.vanilaJs.getDataFormMail = function () {
        var e = CBU_GLOBAL.elements.cbu_menu__input_mail_name, n = CBU_GLOBAL.elements.cbu_menu__input_mail_email,
            _ = CBU_GLOBAL.elements.cbu_menu__input_mail_message,
            i = CBU_GLOBAL.config.path.formMail + "?format=json&jsoncallback=?&hash="+sbjs.get.first_add.hash+"&visit="+sbjs.get.udata.vst+"&pgs="+sbjs.get.session.pgs+"&name=" + e.value + "&email=" + n.value + "&text=" + _.value + "&" + CBU_GLOBAL.vanilaJs.getGenStaticData();
        return console.log(i), i
    }, CBU_GLOBAL.vanilaJs.jsonp = function (e, n) {
        "use strict";

        function _(e, n) {
            var _ = document.createElement("script");
            return _.src = e + (e.indexOf("?") >= 0 ? "&" : "?") + "callback=" + n, _
        }

        if (!e.Promise) throw"Promise not available. Use a polyfill! http://promisesaplus.com/implementations";
        return function (i) {
            return new Promise(function (t, a) {
                var s = "jsonp_callback_" + Math.round(1e5 * Math.random()), l = _(i, s);
                l.onerror = a, n.appendChild(l), /callback=?/.test(i) && (i = i.replace("=?", "=" + s)), e[s] = function (_) {
                    t(_), e[s] = null, delete e[s], n.removeChild(l)
                }
            })
        }
    }(this, document.body), CBU_GLOBAL.initElements = function () {
        CBU_GLOBAL.elements = {};
        var e;
        for (e in CBU_GLOBAL.arrElements) CBU_GLOBAL.elements[e] = CBU_GLOBAL.vanilaJs.getElementById(CBU_GLOBAL.arrElements[e])
    }, CBU_GLOBAL.initElements(), CBU_GLOBAL.widget = {
        btn: {
            show: function () {
                CBU_GLOBAL.vanilaJs.removeClass(CBU_GLOBAL.elements.btn_id, "cbu-hide"), CBU_GLOBAL.vanilaJs.addClass(CBU_GLOBAL.elements.btn_id, "cbu-show")
            }, hide: function () {
                CBU_GLOBAL.vanilaJs.removeClass(CBU_GLOBAL.elements.btn_id, "cbu-show"), CBU_GLOBAL.vanilaJs.addClass(CBU_GLOBAL.elements.btn_id, "cbu-hide")
            }
        },
        menu: {
            show: function () {
                CBU_GLOBAL.vanilaJs.removeClass(CBU_GLOBAL.elements.menu_id, "cbu-hide"), CBU_GLOBAL.vanilaJs.addClass(CBU_GLOBAL.elements.menu_id, "cbu-show")
            }, hide: function () {
                CBU_GLOBAL.vanilaJs.removeClass(CBU_GLOBAL.elements.menu_id, "cbu-show"), CBU_GLOBAL.vanilaJs.addClass(CBU_GLOBAL.elements.menu_id, "cbu-hide")
            }
        },
        menu__buttons: {
            list: ["menu__btn_call", "menu__btn_mail"], unActive: function (e) {
                CBU_GLOBAL.vanilaJs.removeClass(CBU_GLOBAL.elements[e], "active")
            }, onActive: function (e) {
                var n = this;
                this.list.forEach(function (e) {
                    n.unActive(e)
                }), CBU_GLOBAL.vanilaJs.addClass(CBU_GLOBAL.elements[e], "active")
            }
        },
        windows: {
            arr: ["cbu_window_call", "cbu_window_mail", "cbu_window_success", "cbu_window_error"],
            hide_all: function () {
                this.arr.forEach(function (e) {
                    CBU_GLOBAL.vanilaJs.removeClass(CBU_GLOBAL.elements[e], "cbu-show")
                })
            },
            show_call: function () {
                this.hide_all(), CBU_GLOBAL.vanilaJs.addClass(CBU_GLOBAL.elements.cbu_window_call, "cbu-show")
            },
            show_mail: function () {
                this.hide_all(), CBU_GLOBAL.vanilaJs.addClass(CBU_GLOBAL.elements.cbu_window_mail, "cbu-show")
            },
            show_success: function () {
                this.hide_all(), CBU_GLOBAL.vanilaJs.addClass(CBU_GLOBAL.elements.cbu_window_success, "cbu-show")
            },
            show_error: function () {
                this.hide_all(), CBU_GLOBAL.vanilaJs.addClass(CBU_GLOBAL.elements.cbu_window_error, "cbu-show")
            }
        }
    }, CBU_GLOBAL.elements.btn_id.addEventListener("click", function (e) {
        CBU_GLOBAL.widget.btn.hide(), CBU_GLOBAL.widget.menu.show(),   CBU_GLOBAL.widget.menu__buttons.onActive("menu__btn_call"), CBU_GLOBAL.widget.windows.show_call()
    }), CBU_GLOBAL.elements.menu__btn_close.addEventListener("click", function (e) {
        CBU_GLOBAL.widget.menu.hide(), CBU_GLOBAL.widget.btn.show()
    }), CBU_GLOBAL.elements.menu__btn_call.addEventListener("click", function (e) {
        CBU_GLOBAL.widget.menu__buttons.onActive("menu__btn_call"), CBU_GLOBAL.widget.windows.show_call()
    }), CBU_GLOBAL.elements.menu__btn_mail.addEventListener("click", function (e) {
        CBU_GLOBAL.widget.menu__buttons.onActive("menu__btn_mail"), CBU_GLOBAL.widget.windows.show_mail()
    }), CBU_GLOBAL.elements.menu__btn_send_phone.addEventListener("click", function (e) {
        var n = CBU_GLOBAL.elements.menu__btn_input_phone;
        n.value.length > 6 && n.value.length < 40 ? CBU_GLOBAL.vanilaJs.removeClass(CBU_GLOBAL.elements.menu__btn_input_phone, "error") : CBU_GLOBAL.vanilaJs.addClass(CBU_GLOBAL.elements.menu__btn_input_phone, "error"), n.value.length > 6 && n.value.length < 40 && (CBU_GLOBAL.vanilaJs.addClass(CBU_GLOBAL.elements.menu__btn_send_phone, "loading"), CBU_GLOBAL.vanilaJs.addClass(CBU_GLOBAL.elements.menu__btn_send_phone, "disabled"), CBU_GLOBAL.vanilaJs.jsonp(CBU_GLOBAL.vanilaJs.getDataFormCall()).then(function (e) {
            CBU_GLOBAL.vanilaJs.removeClass(CBU_GLOBAL.elements.menu__btn_send_phone, "loading"), CBU_GLOBAL.vanilaJs.removeClass(CBU_GLOBAL.elements.menu__btn_send_phone, "disabled"), "true" == e.ans ? (n.value = "", CBU_GLOBAL.widget.windows.show_success()) : CBU_GLOBAL.widget.windows.show_error()
        })["catch"](function (e) {
            CBU_GLOBAL.vanilaJs.removeClass(CBU_GLOBAL.elements.menu__btn_send_phone, "loading"), CBU_GLOBAL.vanilaJs.removeClass(CBU_GLOBAL.elements.menu__btn_send_phone, "disabled"), CBU_GLOBAL.widget.windows.show_error()
        }))
    }), CBU_GLOBAL.elements.cbu_menu__btn_send_mail.addEventListener("click", function (e) {
        console.log("SEND EMAIL");
        var n = CBU_GLOBAL.elements.cbu_menu__input_mail_name, _ = CBU_GLOBAL.elements.cbu_menu__input_mail_email,
            i = CBU_GLOBAL.elements.cbu_menu__input_mail_message;
        "" == n.value ? CBU_GLOBAL.vanilaJs.addClass(n, "error") : CBU_GLOBAL.vanilaJs.removeClass(n, "error"), "" == _.value ? CBU_GLOBAL.vanilaJs.addClass(_, "error") : CBU_GLOBAL.vanilaJs.removeClass(_, "error"), "" == i.value ? CBU_GLOBAL.vanilaJs.addClass(i, "error") : CBU_GLOBAL.vanilaJs.removeClass(i, "error"), "" != n.value && "" != _.value && "" != i.value && (CBU_GLOBAL.vanilaJs.addClass(CBU_GLOBAL.elements.cbu_menu__btn_send_mail, "loading"), CBU_GLOBAL.vanilaJs.addClass(CBU_GLOBAL.elements.cbu_menu__btn_send_mail, "disabled"), CBU_GLOBAL.vanilaJs.jsonp(CBU_GLOBAL.vanilaJs.getDataFormMail()).then(function (e) {
            CBU_GLOBAL.vanilaJs.removeClass(CBU_GLOBAL.elements.cbu_menu__btn_send_mail, "loading"), CBU_GLOBAL.vanilaJs.removeClass(CBU_GLOBAL.elements.cbu_menu__btn_send_mail, "disabled"), "true" == e.ans ? (n.value = "", _.value = "", i.value = "", CBU_GLOBAL.widget.windows.show_success()) : CBU_GLOBAL.widget.windows.show_error()
        })["catch"](function (e) {
            CBU_GLOBAL.vanilaJs.removeClass(CBU_GLOBAL.elements.cbu_menu__btn_send_mail, "loading"), CBU_GLOBAL.vanilaJs.removeClass(CBU_GLOBAL.elements.cbu_menu__btn_send_mail, "disabled"), CBU_GLOBAL.widget.windows.show_error()
        }))
    }), CBU_GLOBAL.elements.widget_link_ads.addEventListener("click", function (e) {
        e.preventDefault(), window.open("http://wistis.ru?utm_source=widget&url=" + encodeURIComponent(window.location.href) + "&widget_key=" + CBU_GLOBAL.config.widget.key, "_blank")
    })




}(window);

*/
